{#if $viewState == $viewStates.QUESTIONS}
  <Questions questions={questionsToShow} />
  <Forward />
{/if}
{#if $viewState == $viewStates.CITY_SELECT}
  <Back />
  <Cities cities={citiesToShow} />
  <Forward />
{/if}
{#if $viewState == $viewStates.RESULTS}
  <Back />
  <Results items={matchedItems} answers={answers} />
{/if}

<script>
  import Back from './components/Back.html';
  import Cities from './components/Cities.html';
  import Forward from './components/Forward.html';
  import Questions from './components/Questions.html';
  import Results from './components/Results.html';

  export default {
    computed: {
      questionsToShow: ({ $questions, $answers, $viewStates }) => {
        let questions = $questions.slice(0, Object.keys($questions).length - 1);
        return questions;
      },
      citiesToShow: ({ $questions, $answers, $viewStates }) => {
        let cities = [$questions[$questions.length - 1]];
        return cities;
      },
      matchedItems: ({ $pois, $questions, $answers }) => {
        if (Object.keys($answers).length !== $questions.length) {
          return []
        }
        let filtered = $pois
          .filter(({ city }) => city.toLowerCase() === $answers.city.toLowerCase())
          .filter(({ vibe }) => vibe.toLowerCase() === $answers.vibe.toLowerCase())
          .filter(({ budget }) => budget.toLowerCase() === $answers.budget.toLowerCase())
          .filter((poi) => poi["hobbies/interests"].toLowerCase() === $answers["hobbies/interests"].toLowerCase())
        return filtered;
      }
    },
    components: { Cities, Questions, Results, Forward, Back }
  };
</script>
